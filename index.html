<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title>تسجيل الدخول - اختبار البرمجة</title>
  <link rel="stylesheet" href="css/style.css">
  <script src="js/protect.js"></script>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/12.0.0/firebase-app.js";
    import { getFirestore, collection, getDocs } from "https://www.gstatic.com/firebasejs/12.0.0/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyAwAEeLR4JcN1E259nmhkH2aqLJRAITUR4",
      authDomain: "nquiz-b566f.firebaseapp.com",
      projectId: "nquiz-b566f",
      storageBucket: "nquiz-b566f.appspot.com",
      messagingSenderId: "517389586499",
      appId: "1:517389586499:web:d4e3b751940a3d608844f6",
      measurementId: "G-460T0FQBVY"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    async function loginUser(event) {
      event.preventDefault();
      const email = document.getElementById("email").value.trim().toLowerCase();
      const password = document.getElementById("password").value.trim();

      const usersRef = collection(db, "users");
      const snapshot = await getDocs(usersRef);
      let found = false;

      snapshot.forEach(doc => {
        const data = doc.data();
        if (data.email === email && data.password === password) {
          found = true;
          localStorage.setItem("userName", data.name || email);
          window.location.href = "exam.html";
        }
      });

      if (!found) {
        alert("بيانات الدخول غير صحيحة. تأكد من الإيميل وكلمة المرور.");
      }
    }

    window.loginUser = loginUser;
  </script>
</head>
<body>
  <div class="container">
    <h1>تسجيل الدخول إلى الاختبار</h1>
    <form onsubmit="loginUser(event)">
      <input type="email" id="email" placeholder="البريد الإلكتروني" required>
      <input type="password" id="password" placeholder="كلمة المرور" required>
      <button type="submit">دخول</button>
    </form>
  </div>
</body>
</html>
